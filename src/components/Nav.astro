---
import SearchComponent from "./SearchComponent.astro";
import MenuIcon from "../icons/MenuIcon.astro";
import ThemeIcon from "../icons/ThemeIcon.astro";
import MoonIcon from "../icons/MoonIcon.astro";
import SunIcon from "../icons/SunIcon.astro";
import DefaultModeIcon from "../icons/DefaultModeIcon.astro";
---

<nav
    id="nav-bar"
    class="flex dark:bg-slate-900 dark:border-b-slate-800 gap-3 items-center px-2 py-3 bg-slate-50 shadow-sm justify-between border-b border-slate-200"
>
    <div class="flex gap-4 justify-center items-center">
        <button id="menu-btn" class="max-[850px]:flex hidden cursor-pointer">
            <MenuIcon dimension={30} color="oklch(70.7% 0.165 254.624)" />
        </button>
        <script>
            const sideBarParent = document.getElementById("sidebar-parent");
            const sideBar = document.getElementById("sidebar");
            const menuBtn = document.getElementById("menu-btn");

            if (sideBarParent && menuBtn) {
                menuBtn.addEventListener("click", () => {
                    if (sideBar) {
                        sideBar.style.transform = "translateX(-300px)";
                        setTimeout(() => {
                            sideBar.style.transform = "translateX(0)";
                        }, 100);
                    }
                    sideBarParent.style.display = "flex";
                });
            }
            const themeContainer = document.getElementById("theme-container");
            const themeBtn = document.getElementById("theme-btn");
            let isVisible = false;
            if (themeContainer && themeBtn) {
                themeBtn.addEventListener("click", () => {
                    isVisible = !isVisible;
                    if (isVisible) {
                        (themeContainer as HTMLDivElement).style.display =
                            "flex";
                    } else {
                        (themeContainer as HTMLDivElement).style.display =
                            "none";
                    }
                });
                const instances = SVGElement || SVGPathElement || SVGGElement;
                window.addEventListener("click", (e) => {
                    if (
                        !(e.target instanceof instances) &&
                        e.target !== themeBtn
                    ) {
                        isVisible = false;
                        (themeContainer as HTMLDivElement).style.display =
                            "none";
                    }
                });

                const lightModeBtn = document.getElementById("light-mode-btn");
                const darkModeBtn = document.getElementById("dark-mode-btn");
                const defaultModeBtn =
                    document.getElementById("default-mode-btn");

                function store_theme(themeValue: string) {
                    if (themeValue) {
                         document.documentElement.setAttribute("data-theme", themeValue);
                        localStorage.setItem("theme", themeValue);
                    }
                }

                function changeTheme(e: Event) {
                    const target = e.target as HTMLElement;
                    switch (target.id) {
                        case "light-mode-btn":
                            store_theme("light");
                            break;
                        case "dark-mode-btn":
                            store_theme("dark");
                            break;
                        default:
                            const isDarkMode: boolean = window.matchMedia(
                                "(prefers-color-scheme: dark)",
                            ).matches;
                            store_theme(isDarkMode ? "dark" : "light");
                            break;
                    }
                    
                }
                lightModeBtn?.addEventListener("click", changeTheme);
                darkModeBtn?.addEventListener("click", changeTheme);
                defaultModeBtn?.addEventListener("click", changeTheme);
            }
        </script>
        <h1
            style={{ fontFamily: "Grand Hotel" }}
            class="text-[1.5rem] dark:text-white text-slate-700 text-cneter flex gap-2 items-center"
        >
            SomGlossary
        </h1>
    </div>
    <div class="relative flex items-center gap-5 w-full justify-end">
        <SearchComponent maxWidth="50px" placeholder="" />
        <button id="theme-btn" title="Theme" class="cursor-pointer">
            <DefaultModeIcon color="#aad" dimension="32" />
        </button>
        <div
            id="theme-container"
            class="hidden dark:bg-slate-900 dark:text-white absolute top-[120%] right-0 flex-col gap-4 bg-white p-2 border-2 border-indigo-200 rounded-md shadow-md"
        >
            <button
                id="light-mode-btn"
                class="text-start flex gap-2 items-center cursor-pointer italic p-2 border-2 border-transparent hover:border-indigo-300 rounded-md"
            >
                <SunIcon dimension="28" color="oklch(85.2% 0.199 91.936)" />
                Light Mode
            </button>
            <button
                id="dark-mode-btn"
                class="text-start flex gap-2 items-center cursor-pointer italic p-2 border-2 border-transparent hover:border-indigo-300 rounded-md"
            >
                <MoonIcon dimenstion="20" color="oklch(58.5% 0.233 277.117)" />
                Dark Mode
            </button>
            <button
                id="default-mode-btn"
                class="text-start flex gap-2 items-center cursor-pointer italic p-2 border-2 border-transparent hover:border-indigo-300 rounded-md"
            >
                <DefaultModeIcon color="#aad" />
                System default
            </button>
        </div>
    </div>
</nav>
